<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Message Ema</title>
<style>
:root{
  --bg:#070708; --text:#e9eef2; --accent:#ff7a18; --accent-2:#ffb56b;
  --card:#1c1c1f; --card-light:#2c2c2f; --input-bg:#2c2c2f;
}
body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:var(--text);display:flex;flex-direction:column;align-items:center;padding:24px;min-height:100vh;}
.container{width:100%;max-width:700px;background:var(--card);border-radius:14px;padding:24px 28px;box-shadow:0 16px 60px rgba(2,6,23,0.6);}
h1{font-size:28px;margin:0 0 16px;background:linear-gradient(90deg,#fff 0%,var(--accent-2)40%,var(--accent)100%);-webkit-background-clip:text;color:transparent;text-shadow:0 6px 20px rgba(255,122,24,0.06);}
a#back{display:inline-block;margin-bottom:16px;color:var(--accent);font-weight:700;text-decoration:none;}
.message-box{background:#3a3a3c;padding:16px;border-radius:12px;margin-bottom:16px;white-space:pre-wrap;overflow-wrap:break-word;}
#status{min-height:24px;margin-top:8px;color:var(--accent);}
textarea.real-input{width:100%;min-height:120px;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);background:var(--input-bg);color:var(--text);font-size:15px;resize:vertical;caret-color:var(--accent);}
.btn{height:48px;padding:0 18px;border-radius:12px;border:0;cursor:pointer;background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#051014;font-weight:800;position:relative;box-shadow:0 14px 36px rgba(255,122,24,0.12);}
.btn:active{transform:translateY(-2px) scale(.996);}
</style>
</head>
<body>
<div class="container">
  <a href="index.html" id="back">← Retour</a>
  <h1>Message Ema</h1>
  <div id="status"></div>
  <div class="message-box" id="secret"></div>

  <div id="message-form" style="margin-top:16px;display:none;flex-direction:column;gap:12px;">
    <input id="msg-name" class="real-input" placeholder="Ton nom">
    <input id="msg-email" class="real-input" placeholder="Ton email (facultatif)">
    <textarea id="msg-content" class="real-input" placeholder="Ton message"></textarea>
    <button id="send-msg" class="btn">Envoyer</button>
  </div>
</div>

<script>
const API = 'https://pearlier-captivatingly-so.ngrok-free.dev';
const secretBox = document.getElementById('secret');
const msgForm = document.getElementById('message-form');
const msgName = document.getElementById('msg-name');
const msgEmail = document.getElementById('msg-email');
const msgContent = document.getElementById('msg-content');
const sendMsg = document.getElementById('send-msg');
const status = document.getElementById('status');

// Vérification si le code a été entré depuis index.html
const secret = sessionStorage.getItem('private_secret');
if(!secret){
  secretBox.textContent = 'Accès interdit. Tu dois passer par la page d\'accès.';
  msgForm.style.display='none';
} else {
  secretBox.textContent = secret;
  msgForm.style.display='flex';
}

// Envoi du message
sendMsg.addEventListener('click', async ()=>{
  const name = msgName.value.trim();
  const email = msgEmail.value.trim();
  const message = msgContent.value.trim();
  if(!name && !email && !message){
    status.textContent='Tu dois remplir au moins un champ';
    return;
  }
  status.textContent='Envoi en cours...';
  try{
    const res = await fetch(API+'/message',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ name, email, message })
    });
    const j = await res.json();
    if(j.ok){
      status.textContent='Message envoyé !';
      msgName.value=''; msgEmail.value=''; msgContent.value='';
    } else status.textContent='Erreur envoi';
  }catch(err){status.textContent='Erreur réseau';}
});
</script>
</body>
</html>
