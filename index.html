<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>AccÃ¨s sÃ©curisÃ©</title>
<style>
:root{
Â  --bg:#070708; --card:#0f1113; --accent:#ff7a18; --accent-2:#ffb56b;
Â  --neon-orange: rgba(255,122,24,0.22); --text:#e9eef2; --muted:#96a0aa; --error:#ff3b3b;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
Â  margin:0; font-family:Inter,system-ui,Arial,sans-serif;
Â  background:linear-gradient(180deg,#050507,var(--bg));
Â  color:var(--text); display:flex;align-items:center;justify-content:center;padding:24px;
}
.container{
Â  width:100%;max-width:600px;
Â  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
Â  border-radius:14px;padding:28px;border:1px solid rgba(255,255,255,0.03);
Â  box-shadow: 0 16px 60px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
}
.title{
Â  font-size:30px;font-weight:800;margin:0 0 6px;line-height:1;
Â  background: linear-gradient(90deg, #fff 0%, var(--accent-2) 40%, var(--accent) 100%);
Â  -webkit-background-clip: text;background-clip: text;color: transparent;
Â  text-shadow: 0 8px 30px rgba(255,122,24,0.06);
}
.lead{margin:6px 0 18px;color:var(--muted);font-size:14px}
.input-row{display:flex;gap:12px;align-items:center;margin-bottom:12px}
.input{flex:1;position:relative}
.real-input{position:absolute;left:0;top:0;width:100%;height:100%;opacity:0;caret-color: transparent;}
.display{
Â  width:100%;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);
Â  background:rgba(255,255,255,0.02);color:var(--text);font-size:15px;min-height:46px;
Â  display:flex;align-items:center;gap:4px;overflow:hidden;flex-wrap:wrap;
Â  transition: box-shadow .12s, transform .12s;
}
.display.focus{box-shadow:0 14px 30px rgba(0,0,0,0.6), 0 0 28px var(--neon-orange); transform:translateY(-3px)}
.dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,0.2);display:inline-block;margin:0 2px}
.controls{display:flex;align-items:center;gap:12px;margin-top:8px;color:var(--muted);font-size:13px}
.btn{
Â  --h:48px;height:var(--h);padding:0 18px;border-radius:12px;border:0;cursor:pointer;
Â  background:linear-gradient(180deg,var(--accent),var(--accent-2));
Â  color:#051014;font-weight:800;letter-spacing:.4px;position:relative;overflow:hidden;
Â  box-shadow: 0 14px 36px rgba(255,122,24,0.12), 0 6px 0 rgba(0,0,0,0.35);
Â  transition: transform .14s cubic-bezier(.2,.9,.2,1), box-shadow .14s, filter .12s;
}
.btn::before{
Â  content:'';position:absolute;inset:0;border-radius:12px;
Â  box-shadow: 0 0 40px rgba(255,122,24,0.18), inset 0 0 10px rgba(255,200,140,0.03);
Â  pointer-events:none;opacity:.95;
}
.btn:hover{transform: translateY(-6px) rotateX(4deg) scale(1.02);filter:brightness(1.04);box-shadow:0 22px 60px rgba(255,122,24,0.18)}
.btn:active{transform: translateY(-2px) scale(.996)}
.ripple{position:absolute;border-radius:50%;transform:translate(-50%,-50%) scale(.6);opacity:.4;pointer-events:none;animation:rippleAnim .6s ease-out forwards;background:rgba(255,255,255,0.12)}
@keyframes rippleAnim{to{transform:translate(-50%,-50%) scale(4);opacity:0}}
.status{min-height:28px;margin-top:10px;font-weight:700;color:var(--muted);font-size:14px}
.status.ok{color:#7ff0c9;text-shadow:0 8px 30px rgba(0,200,160,0.05)}
.status.error{
Â  color:var(--error);text-shadow:0 0 12px rgba(255,59,59,0.6);
Â  font-weight:900;font-size:15px;background: linear-gradient(90deg, rgba(255,59,59,0.02), transparent);
Â  padding:8px;border-radius:8px;margin-top:12px;display:inline-block;
}
.shake{animation:shake .42s cubic-bezier(.36,.07,.19,.97)}
@keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-8px)}50%{transform:translateX(6px)}75%{transform:translateX(-4px)}100%{transform:translateX(0)}}
.hint{margin-top:12px;color:var(--muted);font-size:13px;background: rgba(255,255,255,0.01);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.01)}
@media (max-width:520px){ .input-row{flex-direction:column} .btn{width:100%} }
</style>
</head>
<body>
<div class="container" role="main" aria-labelledby="title">
Â  <h1 id="title" class="title">AccÃ¨s sÃ©curisÃ©</h1>
Â  <p class="lead">Entre le mot de passe pour dÃ©verrouiller la page</p>
Â  <div class="input-row">
Â  Â  <div class="input" style="flex:1">
Â  Â  Â  <input id="real" class="real-input" type="password" autocomplete="one-time-code" aria-label="mot de passe">
Â  Â  Â  <div id="display" class="display" tabindex="0" role="textbox" aria-label="affichage du mot de passe"></div>
Â  Â  </div>
Â  Â  <button id="submit" class="btn" aria-label="Valider">Valider</button>
Â  </div>
Â  <div class="controls">
Â  Â  <label style="display:flex;align-items:center;gap:8px"><input id="show" type="checkbox">Afficher le mot de passe</label>
Â  Â  <div style="flex:1"></div>
Â  </div>
Â  <div id="status" class="status" aria-live="polite"></div>
Â  <div class="hint">
Â  Â  <strong>Indice :</strong> C'est mon prÃ©nom avec une majuscule, il y a ensuite / puis ma date de naissance, puis le prÃ©nom avec une majuscule d'une personne que j'aime, puis encore un /, le prÃ©nom de mon chat avec une majuscule, la 24e lettre de l'alphabet et un !<br>
Â  Â  <em>exemple : Gilbert/1983/Gabriel/ProutG!</em>
Â  </div>
</div>
<script>
const API='https://message-cache-backend.onrender.com';
const real=document.getElementById('real');
const display=document.getElementById('display');
const show=document.getElementById('show');
const submit=document.getElementById('submit');
const status=document.getElementById('status');

display.addEventListener('click',()=>real.focus());
display.addEventListener('focus',()=>real.focus());
real.addEventListener('focus',()=>display.classList.add('focus'));
real.addEventListener('blur',()=>display.classList.remove('focus'));
show.addEventListener('change',()=>updateDisplay());

// L'Ã©vÃ©nement qui dÃ©clenche l'affichage des points/caractÃ¨res Ã  chaque frappe
real.addEventListener('input',()=>updateDisplay());

function updateDisplay(){
Â  display.innerHTML='';
Â  const s=real.value||'';
Â  const masked=!show.checked;
Â  for(let i=0;i<s.length;i++){
Â  Â  if(masked){
Â  Â  Â  const dot=document.createElement('span'); dot.className='dot'; display.appendChild(dot);
Â  Â  } else {
Â  Â  Â  const ch=document.createElement('span'); ch.textContent=s[i]; display.appendChild(ch);
Â  Â  }
Â  }
Â  const caret=document.createElement('span'); caret.textContent=' '; caret.style.width='2px'; display.appendChild(caret);
}

function rippleAt(e,el){
Â  const r=document.createElement('span'); r.className='ripple';
Â  const rect=el.getBoundingClientRect();
Â  const x=(e.clientX||rect.left+rect.width/2)-rect.left;
Â  const y=(e.clientY||rect.top+rect.height/2)-rect.top;
Â  r.style.left=x+'px'; r.style.top=y+'px'; el.appendChild(r); setTimeout(()=>r.remove(),700);
}

submit.addEventListener('click',async e=>{rippleAt(e,submit); await sendPassword();});
real.addEventListener('keydown',async e=>{if(e.key==='Enter'){await sendPassword();}});

let busy=false;
async function sendPassword(){
Â  if(busy) return; busy=true;
Â  status.className='status'; status.textContent='VÃ©rification...';
Â  const code=real.value;
Â  if(!code){status.textContent='Entre un mot de passe.'; status.className='status error shake'; setTimeout(()=>status.classList.remove('shake'),420); busy=false; return;}
Â  try{
Â  Â  const r=await fetch(API+'/auth',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({code})});
Â  Â  const j=await r.json();
Â  Â  if(r.ok&&j.ok){
Â  Â  Â  status.textContent='AccÃ¨s autorisÃ©. Copie le token ciâ€‘dessous.'; status.className='status ok';
Â  Â  Â  if(j.token){
Â  Â  Â  Â  const t=document.createElement('div'); t.style.marginTop='10px';
Â  Â  Â  Â  t.style.padding='10px'; t.style.background='rgba(255,255,255,0.02)';
Â  Â  Â  Â  t.style.borderRadius='8px'; t.style.wordBreak='break-all';
Â  Â  Â  Â  t.textContent=j.token; status.appendChild(t);
Â  Â  Â  }
Â  Â  } else {
Â  Â  Â  status.textContent=j.error||'mot de passe incorrect, essaie encore ðŸ˜‰'; status.className='status error shake'; setTimeout(()=>status.classList.remove('shake'),420);
Â  Â  }
Â  } catch(err){
Â  Â  status.textContent='Erreur rÃ©seau. Le serveur est peut-Ãªtre endormi.'; status.className='status error shake'; setTimeout(()=>status.classList.remove('shake'),420);
Â  } finally{busy=false;}
}

// Correction/AmÃ©lioration : Initialise l'affichage au chargement de la page
// Ceci garantit que si le champ Ã©tait prÃ©-rempli, l'affichage (points) est immÃ©diatement mis Ã  jour.
updateDisplay(); 
</script>
</body>
</html>
