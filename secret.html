<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Message secret</title>
<style>
body{font-family:Inter,Arial,sans-serif;background:#070708;color:#e9eef2;margin:0;padding:20px;display:flex;flex-direction:column;align-items:center}
#messageBox{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:20px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 16px 60px rgba(2,6,23,0.6);max-width:800px;width:100%;overflow:auto;max-height:80vh;white-space:pre-wrap}
#anonForm{margin-top:20px;width:300px}
input,textarea{width:100%;margin:5px 0;padding:5px;border-radius:8px;border:1px solid rgba(255,255,255,0.1)}
button{width:100%;padding:8px;border-radius:12px;background:linear-gradient(180deg,#ff7a18,#ffb56b);border:0;color:#051014;font-weight:800;cursor:pointer}
#status{margin-top:5px;font-size:14px;color:#7ff0c9}
</style>
</head>
<body>
<h1>Message secret</h1>
<div id="messageBox">Chargement...</div>

<div id="anonForm">
<h3>Laisser un message anonyme</h3>
<input id="name" placeholder="Nom (optionnel)">
<input id="email" placeholder="Email (optionnel)">
<textarea id="message" placeholder="Ton message"></textarea>
<button onclick="sendMessage()">Envoyer</button>
<p id="status"></p>
</div>

<script>
const API = 'https://pearlier-captivatingly-so.ngrok-free.dev'; // ton backend Node.js

async function loadMessage() {
    const secret = sessionStorage.getItem('private_secret');
    if(!secret){
        alert("Accès refusé ! Retour à l'accueil.");
        window.location.href='index.html';
        return;
    }
    document.getElementById('messageBox').innerText = secret;
}

loadMessage();

async function sendMessage(){
    const name = document.getElementById('name').value || "Anonyme";
    const email = document.getElementById('email').value || "";
    const message = document.getElementById('message').value;
    const secret = sessionStorage.getItem('private_secret');
    if(!secret) return alert("Accès refusé");

    try{
        const res = await fetch(API + '/message', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ token: secret, name, email, message })
        });
        const j = await res.json();
        document.getElementById('status').innerText = j.ok ? "Message envoyé !" : j.error;
    }catch(err){
        document.getElementById('status').innerText="Erreur réseau";
    }
}
</script>
</body>
</html>
