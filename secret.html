<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Message secret</title>
<style>
body{background:#070708;color:#e9eef2;font-family:Inter,system-ui,Arial,sans-serif;padding:24px;display:flex;justify-content:center;align-items:flex-start;min-height:100vh}
.container{max-width:800px;background:rgba(255,255,255,0.02);padding:28px;border-radius:14px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 16px 60px rgba(2,6,23,0.6)}
textarea{width:100%;min-height:100px;padding:12px;border-radius:10px;border:none;background:rgba(255,255,255,0.03);color:#e9eef2;font-family:Inter,system-ui,Arial,sans-serif;resize:vertical;margin-top:12px}
</style>
</head>
<body>
<div class="container">
<h1>Message secret</h1>
<pre id="message" style="white-space:pre-wrap;word-wrap:break-word"></pre>

<h2>Laisser un message anonyme</h2>
<input id="name" placeholder="Nom (optionnel)" />
<input id="email" placeholder="Email (optionnel)" />
<textarea id="msg" placeholder="Message"></textarea>
<button id="send">Envoyer</button>
<div id="status"></div>
</div>

<script>
const API = 'https://pearlier-captivatingly-so.ngrok-free.dev';
const messageEl = document.getElementById('message');
const nameEl = document.getElementById('name');
const emailEl = document.getElementById('email');
const msgEl = document.getElementById('msg');
const sendBtn = document.getElementById('send');
const status = document.getElementById('status');

messageEl.textContent = sessionStorage.getItem('private_secret') || 'Aucun message à afficher.';

sendBtn.addEventListener('click', async ()=>{
  const data = {
    name: nameEl.value || "Anonyme",
    email: emailEl.value || "",
    message: msgEl.value || "",
    date: new Date().toISOString()
  };
  try{
    const res = await fetch(API+'/message', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(data)
    });
    const j = await res.json();
    if(j.ok){ status.textContent='Message envoyé !'; nameEl.value=''; emailEl.value=''; msgEl.value=''; }
    else status.textContent='Erreur lors de l\'envoi.';
  }catch(err){ status.textContent='Erreur réseau.'; }
});
</script>
</body>
</html>
