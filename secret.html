<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Message Ema</title>
<style>
:root{
  --bg:#070708; --text:#e9eef2; --muted:#96a0aa;
  --accent:#ff7a18; --accent-2:#ffb56b;
  --card:#1c1c1f; --card-light:#2c2c2f; --input-bg:#2c2c2f;
}
body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:var(--text);display:flex;flex-direction:column;align-items:center;padding:24px;min-height:100vh;}
.container{width:100%;max-width:700px;background:var(--card);border-radius:14px;padding:24px 28px;box-shadow:0 16px 60px rgba(2,6,23,0.6);}
h1{font-size:28px;margin:0 0 12px;background:linear-gradient(90deg,#fff 0%,var(--accent-2)40%,var(--accent)100%);-webkit-background-clip:text;color:transparent;text-shadow:0 6px 20px rgba(255,122,24,0.06);}
p.lead{color:var(--muted);margin-bottom:16px;}
a#back{display:inline-block;margin-bottom:16px;color:var(--accent);font-weight:700;text-decoration:none;}
.message-box{background:#3a3a3c;padding:16px;border-radius:12px;margin-bottom:16px;white-space:pre-wrap;overflow-wrap:break-word;}
.input-row{display:flex;gap:12px;align-items:center;margin-bottom:12px;position:relative;}
.real-input{flex:1;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);background:var(--input-bg);color:var(--text);font-size:15px;caret-color:var(--accent);}
.btn{height:48px;padding:0 18px;border-radius:12px;border:0;cursor:pointer;background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#051014;font-weight:800;position:relative;box-shadow:0 14px 36px rgba(255,122,24,0.12);}
.btn:active{transform:translateY(-2px) scale(.996);}
#status{min-height:24px;margin-top:8px;color:var(--accent);}
.hint{margin-top:12px;color:var(--muted);font-size:13px;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.05);background:rgba(255,255,255,0.02);}
</style>
</head>
<body>
<div class="container">
  <a href="index.html" id="back">‚Üê Retour</a>
  <h1>Message Ema</h1>
  <p class="lead">Entre le mot de passe pour voir le message</p>
  <div class="input-row">
    <input id="real" class="real-input" type="password" autocomplete="one-time-code" aria-label="mot de passe">
    <button id="submit" class="btn">Valider</button>
  </div>
  <div id="status"></div>
  <div class="message-box" id="secret" style="display:none;"></div>

  <div class="input-row" id="message-form" style="display:none;">
    <input id="msg-name" class="real-input" placeholder="Ton nom">
    <input id="msg-email" class="real-input" placeholder="Ton email (facultatif)">
    <input id="msg-content" class="real-input" placeholder="Ton message">
    <button id="send-msg" class="btn">Envoyer</button>
  </div>
  <div class="hint">
    <strong>Indice :</strong> C'est mon pr√©nom avec une majuscule, il y a ensuite / puis ma date de naissance, un / puis le pr√©nom avec une majuscule d'une personne que j'aime, puis encore un /, le pr√©nom de mon chat avec une majuscule, la 24e lettre de l'alphabet et un !<br>
    <em>exemple : Gilbert/1983/Gabriel/ProutG!</em>
  </div>
</div>

<script>
const API = 'https://pearlier-captivatingly-so.ngrok-free.dev';
const real = document.getElementById('real');
const submit = document.getElementById('submit');
const status = document.getElementById('status');
const secretBox = document.getElementById('secret');
const msgForm = document.getElementById('message-form');
const msgName = document.getElementById('msg-name');
const msgEmail = document.getElementById('msg-email');
const msgContent = document.getElementById('msg-content');
const sendMsg = document.getElementById('send-msg');

// Affiche le message si session existe
function showSecret(){
  const secret = sessionStorage.getItem('private_secret');
  if(!secret){
    secretBox.textContent = 'Acc√®s interdit. Tu dois entrer le code.';
    secretBox.style.display='block';
    msgForm.style.display='none';
  } else {
    secretBox.textContent = secret;
    secretBox.style.display='block';
    msgForm.style.display='flex';
  }
}

// Validation et envoi de message
sendMsg.addEventListener('click', async ()=>{
  const name = msgName.value.trim();
  const email = msgEmail.value.trim();
  const message = msgContent.value.trim();
  if(!name && !email && !message){
    status.textContent='Tu dois remplir au moins un champ';
    return;
  }
  status.textContent='Envoi en cours...';
  try{
    const res = await fetch(API+'/message',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ name, email, message })
    });
    const j = await res.json();
    if(j.ok){
      status.textContent='Message envoy√© !';
      msgName.value=''; msgEmail.value=''; msgContent.value='';
    } else status.textContent='Erreur envoi';
  }catch(err){status.textContent='Erreur r√©seau';}
});

// Validation du mot de passe
submit.addEventListener('click', sendPassword);
real.addEventListener('keydown', e=>{ if(e.key==='Enter') sendPassword(); });

async function sendPassword(){
  const code = real.value.trim();
  if(!code){status.textContent='Entre un mot de passe'; return;}
  status.textContent='V√©rification...';
  try{
    const res = await fetch(API+'/auth',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ code })
    });
    const j = await res.json();
    if(res.ok && j.ok){
      sessionStorage.setItem('private_secret', j.secret);
      showSecret();
    } else {
      status.textContent=j.error || 'Code incorrect üòâ';
    }
  }catch(err){status.textContent='Erreur r√©seau';}
}

// Au chargement, on v√©rifie si d√©j√† session
showSecret();
</script>
</body>
</html>
