<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Acc√®s s√©curis√©</title>
<style>
:root{
  --bg:#070708; --text:#e9eef2; --muted:#96a0aa;
  --accent:#ff7a18; --accent-2:#ffb56b; --neon-orange: rgba(255,122,24,0.22);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;font-family:Inter,system-ui,Arial,sans-serif;
  background:linear-gradient(180deg,#050507,var(--bg));
  color:var(--text);display:flex;align-items:center;justify-content:center;padding:24px;
}
.container{width:100%;max-width:600px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:28px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 16px 60px rgba(2,6,23,0.6);}

.title{font-size:30px;font-weight:800;margin:0 0 6px;line-height:1;background:linear-gradient(90deg,#fff 0%,var(--accent-2)40%,var(--accent)100%);-webkit-background-clip:text;background-clip:text;color:transparent;text-shadow:0 8px 30px rgba(255,122,24,0.06)}
.lead{margin:6px 0 18px;color:var(--muted);font-size:14px}

.input-row{display:flex;gap:12px;align-items:center;margin-bottom:12px}
.input{flex:1;position:relative}
.real-input{position:absolute;left:0;top:0;width:100%;height:100%;opacity:0;caret-color:transparent}
.display{width:100%;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:var(--text);font-size:15px;min-height:46px;display:flex;align-items:center;gap:8px;overflow:hidden}
.caret{display:inline-block;width:2px;height:1.2em;background:var(--text);animation:blink 1s steps(1) infinite;vertical-align:middle}
@keyframes blink{50%{opacity:0}}

.btn{--h:48px;height:var(--h);padding:0 18px;border-radius:12px;border:0;cursor:pointer;background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#051014;font-weight:800;position:relative;box-shadow:0 14px 36px rgba(255,122,24,0.12)}
.btn:active{transform:translateY(-2px) scale(.996)}
.dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,0.2);display:inline-block}

.controls{display:flex;align-items:center;gap:12px;margin-top:8px;color:var(--muted);font-size:13px}
.status{min-height:28px;margin-top:10px;font-weight:700;color:var(--muted);font-size:14px}

.hint{margin-top:12px;color:var(--muted);font-size:13px;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.01);background:rgba(255,255,255,0.01)}
@media (max-width:520px){ .input-row{flex-direction:column} .btn{width:100%} }
</style>
</head>
<body>
  <div class="container" role="main" aria-labelledby="title">
    <h1 id="title" class="title">Acc√®s s√©curis√©</h1>
    <p class="lead">Entre le mot de passe pour d√©verrouiller la page</p>

    <div class="input-row">
      <div class="input" style="flex:1">
        <input id="real" class="real-input" type="password" autocomplete="one-time-code" aria-label="mot de passe">
        <div id="display" class="display" tabindex="0" role="textbox" aria-label="affichage du mot de passe">
          <span class="caret"></span>
        </div>
      </div>
      <button id="submit" class="btn" aria-label="Valider">Valider</button>
    </div>

    <div class="controls">
      <label style="display:flex;align-items:center;gap:8px"><input id="show" type="checkbox">Afficher le mot de passe</label>
      <div style="flex:1"></div>
    </div>

    <div id="status" class="status" aria-live="polite"></div>

    <div class="hint">
      <strong>Indice :</strong> C'est mon pr√©nom avec une majuscule, il y a ensuite / puis ma date de naissance, un / puis le pr√©nom avec une majuscule d'une personne que j'aime, puis encore un /, le pr√©nom de mon chat avec une majuscule, la 24e lettre de l'alphabet et un !<br>
      <em>exemple : Gilbert/1983/Gabriel/ProutG!</em>
    </div>
  </div>

<script>
const API = 'https://pearlier-captivatingly-so.ngrok-free.dev'; // lien ngrok

const real = document.getElementById('real');
const display = document.getElementById('display');
const show = document.getElementById('show');
const submit = document.getElementById('submit');
const status = document.getElementById('status');

display.addEventListener('click', ()=> real.focus());
display.addEventListener('focus', ()=> real.focus());
real.addEventListener('focus', ()=> display.classList.add('focus'));
real.addEventListener('blur', ()=> display.classList.remove('focus'));

show.addEventListener('change', updateDisplay);
real.addEventListener('input', updateDisplay);

function updateDisplay(){
  const s = real.value || '';
  display.innerHTML = '';
  if(!s){
    const caret = document.createElement('span'); caret.className='caret'; display.appendChild(caret); return;
  }
  const masked = !show.checked;
  for(let i=0;i<s.length;i++){
    if(masked){
      const dot = document.createElement('span'); dot.className='dot'; display.appendChild(dot);
    } else {
      const ch = document.createElement('span'); ch.textContent = s[i]; display.appendChild(ch);
    }
  }
  const caret = document.createElement('span'); caret.className='caret'; display.appendChild(caret);
}

function rippleAt(e, el){
  const r = document.createElement('span'); r.style.position='absolute'; r.style.borderRadius='50%';
  r.style.transform='translate(-50%,-50%) scale(.6)'; r.style.opacity='.4'; r.style.pointerEvents='none';
  r.style.animation='rippleAnim .6s ease-out forwards'; r.style.background='rgba(255,255,255,0.12)';
  const rect = el.getBoundingClientRect();
  const x = (e.clientX || rect.left + rect.width/2) - rect.left;
  const y = (e.clientY || rect.top + rect.height/2) - rect.top;
  r.style.left = x + 'px'; r.style.top = y + 'px'; el.appendChild(r);
  setTimeout(()=> r.remove(),700);
}

submit.addEventListener('click', async (e)=>{
  rippleAt(e, submit);
  await sendPassword();
});
real.addEventListener('keydown', async (e)=>{ if(e.key==='Enter') await sendPassword(); });

let busy=false;
async function sendPassword(){
  if(busy) return;
  busy=true;
  status.className='status'; status.textContent='V√©rification...';
  const code = real.value;
  if(!code){ status.textContent='Entre un mot de passe.'; status.className='status error'; busy=false; return; }

  try{
    const res = await fetch(API + '/auth', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ code })
    });
    const j = await res.json();
    if(res.ok && j.ok){
  if(j.admin){
    window.location.href = 'admin.html';
  } else {
    sessionStorage.setItem('private_secret', j.secret);
    window.location.href = 'secret.html';
  }
}
else {
      status.textContent = j.error || 'mot de passe incorrect, essaie encore üòâ';
      status.className='status error';
      setTimeout(()=> status.classList.remove('shake'), 420);
    }
  }catch(err){
    status.textContent='Erreur r√©seau. Le serveur est peut-√™tre endormi.';
    status.className='status error';
  } finally { busy=false; }
}
</script>
</body>
</html>
