<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Message Caché</title>
<style>
  body {
    margin:0;
    font-family: 'Arial', sans-serif;
    background-color: #1a1a1a;
    color: #fff;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    flex-direction:column;
    text-align:center;
  }

  h1 {
    font-size: 2.5rem;
    color: #00ffff;
    text-shadow: 0 0 5px #00ffff, 0 0 10px #00ffff, 0 0 20px #00ffff;
    margin-bottom:20px;
  }

  p {
    font-size: 1.1rem;
    margin-bottom: 20px;
  }

  input[type="password"] {
    padding:10px 15px;
    font-size:1rem;
    border:2px solid #00ffff;
    border-radius:5px;
    background:transparent;
    color:#fff;
    outline:none;
    transition:0.3s;
  }

  input[type="password"]:focus {
    border-color:#ff9900;
    box-shadow:0 0 10px #ff9900;
  }

  label {
    margin-left:10px;
    font-size:0.9rem;
  }

  button {
    margin-top:20px;
    padding:10px 25px;
    font-size:1.1rem;
    border:none;
    border-radius:5px;
    background:#ff9900;
    color:#fff;
    cursor:pointer;
    transition:0.3s;
    box-shadow: 0 0 5px #ff9900;
  }

  button:hover {
    transform: translateY(-3px);
    box-shadow: 0 0 15px #ff9900, 0 0 25px #ff9900;
  }

  .error {
    margin-top:15px;
    font-weight:bold;
    color:#ff0000;
    text-shadow: 0 0 5px #ff0000, 0 0 10px #ff0000;
    animation: shake 0.3s;
  }

  @keyframes shake {
    0%{ transform: translateX(0); }
    25%{ transform: translateX(-5px);}
    50%{ transform: translateX(5px);}
    75%{ transform: translateX(-5px);}
    100%{ transform: translateX(0);}
  }
</style>
</head>
<body>

<h1>Accès sécurisé</h1>
<p>Entre le mot de passe pour déverrouiller la page.</p>

<input type="password" id="password" placeholder="Mot de passe">
<label><input type="checkbox" id="showPassword"> Afficher le mot de passe</label>
<br>
<button id="submitBtn">Valider</button>
<div id="message"></div>

<script>
const passwordInput = document.getElementById('password');
const showPassword = document.getElementById('showPassword');
const submitBtn = document.getElementById('submitBtn');
const messageDiv = document.getElementById('message');

showPassword.addEventListener('change', () => {
  passwordInput.type = showPassword.checked ? 'text' : 'password';
});

submitBtn.addEventListener('click', async () => {
  const code = passwordInput.value.trim();
  messageDiv.textContent = '';
  if(!code) return;

  try {
    const res = await fetch('https://message-cache-backend.onrender.com/auth', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ code })
    });
    const data = await res.json();

    if(data.ok){
      messageDiv.style.color = '#00ff00';
      messageDiv.textContent = 'Mot de passe correct ! Le lien Discord a été envoyé.';
      messageDiv.style.textShadow = '0 0 5px #00ff00, 0 0 15px #00ff00';
      console.log('Token:', data.token);
    } else {
      throw new Error(data.error || 'Erreur');
    }
  } catch(e){
    messageDiv.classList.add('error');
    messageDiv.textContent = e.message;
    setTimeout(()=> messageDiv.classList.remove('error'), 500);
  }
});
</script>

</body>
</html>
