<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin Panel</title>
<style>
body{background:#070708;color:#e9eef2;font-family:Inter,system-ui,Arial,sans-serif;padding:24px;}
.container{max-width:900px;margin:auto;}
h1,h2{color:#ff7a18}
.tab{display:flex;gap:12px;margin-bottom:12px}
.tab button{padding:10px 20px;border:none;border-radius:8px;background:#222;color:#fff;cursor:pointer}
.tab button.active{background:#ff7a18;color:#051014;font-weight:800}
.section{display:none;margin-top:12px}
.section.active{display:block}
table{width:100%;border-collapse:collapse;color:#fff;margin-top:12px}
th,td{padding:8px;border:1px solid rgba(255,255,255,0.1);text-align:left}
</style>
</head>
<body>
<div class="container">
<h1>Admin Panel</h1>
<div>
<input id="admin-code" type="password" placeholder="Code admin" />
<button id="login">Connexion</button>
<div id="status"></div>
</div>

<div class="tab">
<button data-section="stats">Statistiques</button>
<button data-section="messages">Messages</button>
<button data-section="codes">Tentatives de codes</button>
</div>

<div id="stats" class="section">
<h2>Statistiques</h2>
<div id="stats-content">Chargement...</div>
</div>
<div id="messages" class="section">
<h2>Messages anonymes</h2>
<div id="messages-content">Chargement...</div>
</div>
<div id="codes" class="section">
<h2>Tentatives de codes</h2>
<div id="codes-content">Chargement...</div>
</div>
</div>

<script>
const API = 'https://pearlier-captivatingly-so.ngrok-free.dev';

const sections = document.querySelectorAll('.section');
document.querySelectorAll('.tab button').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    sections.forEach(s=>s.classList.remove('active'));
    document.getElementById(btn.dataset.section).classList.add('active');
    document.querySelectorAll('.tab button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
  });
});

document.getElementById('login').addEventListener('click', async ()=>{
  const code = document.getElementById('admin-code').value;
  try{
    const res = await fetch(API+'/admin-auth',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ code })
    });
    const j = await res.json();
    if(j.ok){
      document.getElementById('status').textContent='Connecté !';
      loadData();
    } else document.getElementById('status').textContent=j.error || 'Code incorrect';
  }catch(err){ document.getElementById('status').textContent='Erreur réseau'; }
});

async function loadData(){
  try{
    const res = await fetch(API+'/stats'); const stats = await res.json();
    const msgs = await fetch(API+'/messages'); const messages = await msgs.json();
    const codes = await fetch(API+'/codes'); const codesData = await codes.json();

    document.getElementById('stats-content').innerHTML=JSON.stringify(stats,null,2);
    document.getElementById('messages-content').innerHTML=messages.map(m=>`[${m.date}] ${m.name} <${m.email}> : ${m.message}`).join('<br>');
    document.getElementById('codes-content').innerHTML=codesData.map(c=>`[${c.date}] ${c.code} - ${c.ip||'ip inconnu'}`).join('<br>');
  }catch(err){ console.log(err); }
}
</script>
</body>
</html>
